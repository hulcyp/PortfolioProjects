<!DOCTYPE html><html>  <head>    <meta content="text/html; charset=ISO-8859-1" http-equiv="content-type">    <title>Cricket Audio: building with Cricket Audio</title>    <link rel="stylesheet" type="text/css" href="style.css">  </head>  <body>    <h1>Building with Cricket Audio</h1>    <a name="arm_instruction_sets"></a>    <h2>ARM instruction sets</h2>    All iOS devices, and most Android devices, run on processors that use some    variant of the ARM instruction set, such as armv5TE, armv6, or armv7.&nbsp;    Devices that support the armv7 instruction can support specialized    instructions (called NEON instructions) that can significantly speed up    audio processing.<br>    <h3>iOS</h3>    All recent iOS devices currently use either the armv7 or armv7s instruction    set.&nbsp; The Cricket Audio library for iOS contains code for both    instruction sets, packed into a single library (a "fat binary").&nbsp; When    you link your app to the Cricket Audio library, the linker will    automatically choose the correct version.&nbsp; (Older iOS devices, prior to    the iPhone 4 and 3rd generation iPod Touch, used the armv6 instruction set;    however, Cricket Audio no longer supports armv6, because Xcode 4.5 no longer    generates armv6 code.)<br>    <h3>Android</h3>    Android native code can be built for either armv5 (referred to as "armeabi")    or armv7 ("armeabi-v7a").&nbsp; Code built for armv5 can run on all devices;    armv7 code will run only on armv7 processors, but will run faster than armv5    code on those processors.&nbsp; Typically you want to provide both versions    in your .apk; at runtime, the operating system will load the armv7 version    if the processor supports it, and will otherwise load the armv5 version.<br>    <br>    If you are using the Android Java interface (the Android SDK), you will just    need to install both versions of the native Cricket Audio library (<span class="filename">libckjava.so</span>)    with your app. (See <a href="#building_for_android_sdk">Building for the      Android SDK</a> below.)<br>    <br>    If you are using the Android native interface (the Android NDK), you will    want to build your native code for both instruction sets, linking each    version to the appropriate version of the Cricket Audio library.&nbsp; By    default, native code built for Android targets only the armv5 instruction    set; while this will work, your code will not run as quickly as it could on    armv7 devices.&nbsp; To build for both instruction sets, you need to specify    them in the&nbsp;<span class="filename">APP_ABI</span> variable in    your&nbsp;<span class="filename">Application.mk</span> file.&nbsp; (See <a      href="#building_for_android_ndk">Building
      for the Android NDK</a> below.)<br>    <br>    <a name="building_for_ios_or_macos"></a>    <h2>Building for iOS or Mac OS</h2>    (Note: these instructions are for Xcode 4.0; the steps required for earlier    versions of Xcode will be slightly different.)<br>    <br>    Select your project in the Project Navigator.&nbsp; In the Project Editor,    select the Build Settings tab.<br>    <br>    In the "Search Paths" section, add the path to the Cricket Audio <span class="filename">inc</span>    directory to the "Header Search Paths" setting.&nbsp; (For example, if the    Cricket Audio distribution is in&nbsp;<span class="filename">../../cricket</span>,    the header search path would be <span class="filename">../../cricket/inc</span>.)<br>    <br>    In the "Search Paths" section, add the path to the Cricket&nbsp;<span class="filename">lib</span>    directory to the "Library Search Paths" setting.&nbsp; To specify the    configuration (debug or release), you can use the<span class="filename"></span>    <span class="filename">${CONFIGURATION}</span> variable.&nbsp; (For example,    if the Cricket Audio distribution is in&nbsp;<span class="filename">../../cricket</span>,    the library search path for iOS would be <span class="filename">../../cricket/lib/ios/${CONFIGURATION}</span>.)<br>    <br>    In the "Linking" section, add&nbsp;<span class="filename">-lck</span> to the    "Other Linker Flags" setting.&nbsp; If you are using the Objective-C    interface, and you have no C++ code in your project, you may also need to    add&nbsp;<span class="filename">-lstdc++</span> also.<br>    <br>    You will also probably want to make sure that any data files (bank files or    stream files) are added to the project and set to be added as resources to    your application bundle.<br>    <br>    If you are not already doing so, you will need to link to the AudioUnit,    AudioToolbox, AVFoundation, and CoreMedia frameworks.<br>    <br>    For an example using Objective-C, take a look at the <a href="examples.html">hellocricket</a>    sample, in&nbsp;<span class="filename">src/samples/hellocricket/ios-objc</span>.&nbsp;
(There
    is an analogous Mac OS project in&nbsp;<span class="filename">macos-objc</span>.)&nbsp;
This
    app was generated from the Xcode template for a window-based iOS app, with    just a few minor changes to play a sound using Cricket Audio.&nbsp; A "Run    Script" build phase was added to the target, which uses the&nbsp;<a href="cktool.html"><span        class="filename">cktool</span></a>    utility to build the binary bank file from the bank description file.&nbsp;    Finally, the binary bank file&nbsp;<span class="filename">hellocricket.ckb</span>    was added to the project, which automatically added it to the "Copy Bundle    Resources" build phase.<br>    <br>    For an example using C++, take a look at the <a href="examples.html">hellocricket</a>    sample, in&nbsp;<span class="filename">src/samples/hellocricket/ios-cpp</span>.&nbsp;
(There
    is an analogous Mac OS project in&nbsp;<span class="filename">macos-cpp</span>.)
This
    app is identical to the Objective-C version, except the app delegate class    uses the C++ Cricket Audio interface instead of Objective-C.&nbsp; The file    containing the app delegate class,&nbsp;<span class="filename">hellocricketAppDelegate.mm</span>,    was renamed from&nbsp;<span class="filename">hellocricketAppDelegate.m</span>,    so the Objective-C++ compiler, rather than the Objective-C compiler, would    be used to build it.&nbsp; (Alternatively, we could have changed the type of    the source file from "Objective-C source" to "Objective-C++ source" in the    File Inspector.)<br>    <a name="building_for_android_sdk"></a>    <h2>Building for the Android SDK</h2>    (Note: these instructions assume you are building your Java code using    Eclipse 3.7 and version 17 of the Android Development Tools (ADT) plugin.)<br>    <br>    Cricket Audio for the Android SDK consists of a Java jar file (<span class="filename">ck.jar</span>)    and one or more native libraries (<span class="filename">libckjava.so</span>).<br>    <br>    First, copy the libraries:<br>    <ul>      <li>copy&nbsp;<span class="filename">lib/android/sdk/ck.jar</span> to        the&nbsp;<span class="filename">libs</span> directory in your project        (creating the directory if necessary);<br>      </li>      <li>copy&nbsp;<span class="filename">lib/android/sdk/armeabi/libckjava.so</span>        to the&nbsp;<span class="filename">libs/armeabi</span> directory in your        project; and</li>      <li>copy&nbsp;<span class="filename">lib/android/sdk/armeabi-v7a/libckjava.so</span>        to the&nbsp;<span class="filename">libs/armeabi-v7a</span> directory in        your project.</li>    </ul>    The&nbsp;<span class="filename">ck.jar</span> file contains the Java    interface that calls into the Cricket Audio native library; you must add    this jar to your project's build path.&nbsp; In Eclipse, select your project    in the Project Explorer and choose "Properties" from the Project menu.&nbsp;    Select "Java Build Path" in the sidebar, click "Add JARs...", and choose    the&nbsp;<span class="filename">ck.jar</span> file.<br>    <br>    The&nbsp;<span class="filename">libckjava.so</span> files contain the native    Cricket Audio code which is called via JNI from the Java interface.&nbsp;    The&nbsp;<span class="filename">armeabi</span> version targets the armv5TE    instruction set; the&nbsp;<span class="filename">armeabi-v7a</span> version    targets the armv7a instruction set.&nbsp; If both are installed, the correct    library will be loaded based on the actual instruction set of the device.<br>    <br>    There are also debug versions for each instruction set (<span class="filename">libckjava_d.so</span>).&nbsp;
    The debug versions are intended for development only, and are only loaded if    you set&nbsp;<span class="filename">Config.NativeDebug</span> to true at    startup.&nbsp; They are significantly slower than the release versions,    because they contain additional run-time consistency checks, so we recommend    that you install the release versions, and only use the debug version to    diagnose specific problems.<br>    <br>    For an example, look at the <a href="examples.html">hellocricket</a>    sample, in&nbsp;<span class="filename">src/samples/hellocricket/android-sdk</span>.&nbsp;&nbsp;
This
    was generated from the Android project template by choosing "New Android    Project" from the File menu, with just a few changes made to play a sound    using Cricket Audio.&nbsp; In the sample, there is a custom Ant build step    that copies the jar file and the native libraries and builds the binary bank    file from the bank description file using&nbsp;<a href="cktool.html"><span class="filename">cktool</span></a>.<br>    <br>    <a name="building_for_android_ndk"></a>    <h2>Building for the Android NDK</h2>    (Note: these instructions assume you are building your native code using the    Android build system and an&nbsp;<span class="filename">Android.mk</span>    file.)<br>    <br>    In your&nbsp;<span class="filename">Android.mk</span> file, before the lines    for your shared library, specify the Cricket Audio library as a "prebuilt"    static library.&nbsp; This is best illustrated using the file from the <a href="examples.html">hellocricket</a>    sample, at&nbsp;<span class="filename">src/samples/hellocricket/android-ndk/jni/Android.mk</span>:<br>    <br>    <code> LOCAL_PATH := $(call my-dir)<br>      <br>      #-------------------------------------------------------------<br>      # specify libck as a "prebuilt" static library<br>      <br>      include $(CLEAR_VARS)<br>      LOCAL_MODULE := ck<br>      <br>      ifeq ($(NDK_DEBUG),1)<br>      LOCAL_SRC_FILES :=      ../../../../../lib/android/ndk/$(TARGET_ARCH_ABI)/debug/libck.a<br>      else<br>      LOCAL_SRC_FILES :=      ../../../../../lib/android/ndk/$(TARGET_ARCH_ABI)/release/libck.a<br>      endif<br>      &nbsp;&nbsp;&nbsp; <br>      include $(PREBUILT_STATIC_LIBRARY)<br>      &nbsp;&nbsp;&nbsp; <br>      #-------------------------------------------------------------<br>      &nbsp;&nbsp;&nbsp; <br>      include $(CLEAR_VARS)<br>      &nbsp;&nbsp;&nbsp; <br>      LOCAL_MODULE&nbsp;&nbsp;&nbsp;&nbsp; := hellocricket<br>      LOCAL_SRC_FILES&nbsp; := hellocricket.cpp<br>      &nbsp;&nbsp;&nbsp; <br>      LOCAL_C_INCLUDES := $(LOCAL_PATH)/../../../../../inc<br>      LOCAL_STATIC_LIBRARIES := ck cpufeatures<br>      LOCAL_LDLIBS&nbsp;&nbsp;&nbsp;&nbsp; += -llog<br>      &nbsp;&nbsp;&nbsp; <br>      include $(BUILD_SHARED_LIBRARY)<br>      <br>      $(call import-module,android/cpufeatures)<br>    </code><br>    In the first section, the prebuilt library called "ck" is defined, pointing    to the debug or release version of&nbsp;<span class="filename">libck.a</span>    depending on the&nbsp;<span class="filename">NDK_DEBUG</span> setting, and    to the version for the appropriate ARM instruction set.<br>    <br>    In the second section, the include path is set to the Cricket Audio <span class="filename">inc</span>    directory, and the prebuilt "ck" library is specified using the&nbsp;<span class="filename">LOCAL_STATIC_LIBRARIES</span>    variable.&nbsp; Note also that&nbsp;<span class="filename">liblog.a</span>    has been added to the&nbsp;<span class="filename">LOCAL_LDLIBS</span>    variable, as it is required by Cricket Audio.<br>    <br>    Note also that&nbsp;<span class="filename">cpufeatures</span> is specified    in the&nbsp;<span class="filename">LOCAL_STATIC_LIBRARIES</span> variable,    and is built with the&nbsp;<span class="filename">$(call      import-module,android/cpufeatures)</span> line at the end of the    file.&nbsp; This is required for the armeabi-v7a version to detect when NEON    optimizations may be used.<br>    <br>    To build your application for both ARM instruction sets, specify them both    in your&nbsp;<span class="filename">Application.mk</span> file:<br>    <br>    <code> APP_ABI := armeabi armeabi-v7a </code><br>    In the hellocricket sample, there is also a custom Ant build step that    builds the binary bank file from the bank description file using&nbsp;<a href="cktool.html"><span        class="filename">cktool</span></a>.&nbsp;
This
    example uses a Java activity class that calls the native Cricket Audio code    using a JNI call; the build process would be the same for an app that uses a    native activity.&nbsp; Note that you must first build the native code    using&nbsp;<span class="filename">ndk-build</span> before building and    running the Java activity.<br>    <a name="building_for_windows"></a>    <h2>Building for Windows</h2>    (Note: these instructions are for Visual Studio 2010; the steps required for    other version of Visual Studio will be slightly different.)<br>    <br>    Right-click on the project in the Solution Explorer, and choose Properties.<br>    <br>    Under C++ » General » Additional Include Directories, add the path to the    Cricket Audio <span class="filename">inc</span> directory.&nbsp; (For    example, if the Cricket Audio distribution is in&nbsp;<span class="filename">../../cricket</span>,    the header search path would be <span class="filename">../../cricket/inc</span>.)<br>    <br>    Under Linker » General » Additional Library Directories, add the path to the    appropriate Cricket Audio library directory.&nbsp; The correct path is:<br>    <br>    <div style="margin-left: 40px;"><span style="font-style: italic;">VisualStudioVersion</span>/<span        style="font-style: italic;">Platform</span>/<span        style="font-style: italic;">Configuration</span><br>    </div>    <br>    where<br>    <br>    <div style="margin-left: 40px;"><span style="font-style: italic;">VisualStudioVersion</span>      is one of:<br>      <ul>        <li><span class="filename">vs10.0</span> (Visual Studio 2010)</li>        <li><span class="filename">vs11.0</span> (Visual Studio 2012)</li>      </ul>      <span style="font-style: italic;">Platform</span> is one of:<br>      <ul>        <li><span class="filename">Win32</span></li>        <li><span class="filename">x64</span></li>      </ul>      and <span style="font-style: italic;">Configuration</span> is one of:<br>      <ul>        <li class="filename">DebugStatic7</li>        <li class="filename">DebugStatic8</li>        <li class="filename">DebugDynamic7</li>        <li class="filename">DebugDynamic8</li>        <li class="filename">ReleaseStatic7</li>        <li class="filename"> ReleaseStatic8</li>        <li class="filename"> ReleaseDynamic7</li>        <li class="filename"> ReleaseDynamic8</li>      </ul>    </div>    If your program is linking to the Microsoft runtime statically (i.e. is    compiled with <span class="filename">/MT</span> or <span class="filename">/MTd</span>),
    then use one of the "Static" configurations; if it is linking to the    Microsoft runtime dynamically (i.e. is compiled with <span class="filename">/MD</span>    or <span class="filename">/MDd</span>), then use one of the "Dynamic"    configurations.<br>    <br>    The "7" configurations are built with XAudio2 2.7, available in the June    2010 release of the DirectX SDK, and will work on any version of Windows on    which that version of the DirectX runtime has been installed.&nbsp; The "8"    configurations are built with XAudio2 2.8, and will work on Windows 8    without any additional runtime component installation, but will not work on    any previous versions of Windows.<br>    <br>    If your program is a Windows Store app (formerly called a Metro app), you    must use either the <span class="filename">DebugDynamic8</span> or <span class="filename">ReleaseDynamic8</span>    library.<br>    <br>    You can use the Visual Studio macros&nbsp;<span class="filename">$(Configuration)</span>,&nbsp;<span      class="filename">$(VisualStudioVersion)</span>,    and&nbsp;<span class="filename">$(Platform)</span> to specify the correct    path for your program.&nbsp; For example, if the Cricket Audio distribution    is in&nbsp;<span class="filename">../../cricket</span>, and you are linking    statically to the runtime and targeting Windows 7, the library search path    would be <span class="filename">../../cricket/lib/vs$(VisualStudioVersion)/$(Platform)/$(Configuration)Static7</span>.<br>    <br>    Under Linker » Input » Additional Dependencies, add&nbsp;<span class="filename">ck.lib</span>    to the list of libraries.<br>    <br>    <br>  </body></html>